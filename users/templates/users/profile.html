{% load static %}

<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <title>Dashboard</title>
    <link type="text/css" href="{% static 'users/css/users_profile.css' %}" rel="stylesheet"/>
</head>
<body>
<header class="header-item">
    <div class="profile-info">
        <span class="profile-name">NEZHNA</span>
        <span class="profile-email">Website ID: {{ user.email }}</span>
        <span class="available-funds">Available Funds: <span class="user-balance">{{ user.balance }}</span></span>
        <button class="add-funds-btn">+ Add Funds</button>
    </div>

    <div class="logout">
        <a href="{% url 'users:logout' %}"
           onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
            Log out
        </a>
        <form id="logout-form" method="POST" style="display: none;" action="{% url 'users:logout' %}">
            {% csrf_token %}
            <button type="submit">Log out</button>
        </form>
    </div>
</header>
<div id="modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>Replenish Balance</h3>
        <form id="balance-form" method="post" data-url="{% url 'order:create-order' %}">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="mb-3">
                <label for="id_email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="id_email" name="email" value="{{ form.email.value }}">
                {{ form.email.errors }}
            </div>

            <div class="mb-3">
                <label for="id_balance_for_replenishment" class="form-label">Balance for Replenishment</label>
                <input type="number" class="form-control" id="id_balance_for_replenishment"
                       name="balance_for_replenishment"
                       value="{{ form.balance_for_replenishment.value }}" required>
                {{ form.balance_for_replenishment.errors }}
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <div id="balance-form-message" style="display: none;"></div> <!-- Блок для ошибок -->
    </div>
</div>

<div id="success-message" style="display: none;"></div> <!-- Блок для успешного сообщения -->
<main>
    <section class="services">
        <h2>Select Services</h2>
        <div class="service-buttons">
            {% for service, service_option, form in forms %}
            <button class="service-btn" onclick="toggleForm('form-{{ service_option.id }}')">
                <span>{{ service.name }}</span><br>
                <span>{{ service_option.name }}</span>
            </button>
            {% endfor %}
        </div>
    </section>

    <!-- Формы для каждого сервиса -->
    <section class="service-forms">
        {% for service, service_option, form in forms %}
        <div id="form-{{ service_option.id }}" class="service-form" style="display:none;">
            <h3>{{ service.name }} - {{ service_option.name }}</h3>
            <form method="POST" class="purchase-form">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">Buy</button>
            </form>
        </div>
        {% endfor %}
    </section>


    <section class="user-orders">
        <h2>Your Orders</h2>
        {% if orders %}
        <table>
            <thead>
            <tr>
                <th>Service</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Total Price</th>
                <th>Period</th>
                <th>Status</th>
                <th>Start time</th>
            </tr>
            </thead>
            <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.service.name }}</td>
                <td>{{ order.service_option.name }}</td>
                <td>{{ order.quantity }}</td>
                <td>{{ order.total_price }}</td>
                <td>{% if order.period %} {{ order.period }} {% else %} - {% endif %}</td>
                <td>{{ order.status }}</td>
                <td>{{ order.created_at }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <table>
            <thead>
            <tr>
                <th>Service</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Total Price</th>
                <th>Status</th>
                <th>Start time</th>
            </tr>
            </thead>
        </table>
        {% endif %}
    </section>
</main>

<script src="{% static 'users/js/profile_form.js' %}"></script>
<script src="{% static 'users/js/order_form.js' %}"></script>
</body>
</html>